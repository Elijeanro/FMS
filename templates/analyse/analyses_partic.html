<!DOCTYPE html>
{% extends 'bases/base1.html' %}


{% block title %}
Analyses globales
{% endblock title %}


{% block contenu %}
<div class="wrapper">
  
  {% if type_bilan == 'finances' %}
  <!-- Page Heading -->
  <br>
  <div class="row d-sm-flex justify-content-center mb-2">

    <h1 class="h3 mb-0 text-gray-800">Bilan financier sur l'engin : {{engin.immatriculation}}
      ({{engin.type_engin.designation}}) </h1>

  </div>

  <div class="row d-sm-flex justify-content-center mb-2">

    <div class="col-xl-3 col-md-6 mb-4" data-toggle="collapse" data-target="#carburantSection" aria-expanded="false"
    aria-controls="carburantSection">
      <div class="card border-left-primary shadow h-100 py-2">
        <div class="card-body">
          <div class="row no-gutters align-items-center">
            <div class="col mr-2">
              <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                Total dépensé en ravitaillement de carburant</div>
              <div class="h5 mb-0 font-weight-bold text-gray-800"> {{cout_r}} F CFA</div>
            </div>
            
          </div>
        </div>
      </div>
    </div>

    <div class="col-xl-3 col-md-6 mb-4" data-toggle="collapse" data-target="#maintenanceSection" aria-expanded="false"
    aria-controls="maintenanceSection">
      <div class="card border-left-success shadow h-100 py-2">
        <div class="card-body">
          <div class="row no-gutters align-items-center">
            <div class="col mr-2">
              <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                Total dépensé en maintenance de l'engin</div>
              <div class="h5 mb-0 font-weight-bold text-gray-800">{{cout_m}} F CFA</div>
            </div>
            
          </div>
        </div>
      </div>
    </div>

    <!-- Earnings (Monthly) Card Example -->
    <div class="col-xl-3 col-md-6 mb-4" data-toggle="collapse" data-target="#vidangeSection" aria-expanded="false"
    aria-controls="vidangeSection">
      <div class="card border-left-info shadow h-100 py-2">
        <div class="card-body">
          <div class="row no-gutters align-items-center">
            <div class="col mr-2">
              <div class="text-xs font-weight-bold text-info text-uppercase mb-1">Total dépensé en vidange
                de l'engin
              </div>
              <div class="row no-gutters align-items-center">
                <div class="col-auto">
                  <div class="h5 mb-0 mr-3 font-weight-bold text-gray-800">{{cout_v}} F CFA
                  </div>
                </div>

              </div>
            </div>
            
          </div>
        </div>
      </div>
    </div>


  </div>
  <div class="row d-sm-flex justify-content-center mb-2">

    <div class="container mt-3">
      <div class="row">
        <div class="col">
          <div class="collapse" id="carburantSection">
            <h4 class="h3 mb-0 text-gray-800">Point sur le carburant</h4>
            <table class="table table-bordered" id="dataTable2" width="100%" cellspacing="0">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Engin</th>
                  <th>Marque</th>
                  <th>Modèle</th>
                  <th>Immat.</th>
                  <th>Montant</th>
                  <th>Quantité</th>
                  <th>Carb. Dispo</th>
                  <th>Niveau de carburant</th>
                  <th>Observation</th>
                  
                </tr>
              </thead>
              <tbody>
                {% for r in ravitaillements %}
                <tr data-bs-toggle="collapse" data-bs-target="#details_{{ forloop.counter }}" aria-expanded="false"
                  aria-controls="details_{{ forloop.counter }}">
                  <td>{{ r.date_rav }}</td>
                  <td>{{ r.engin_rav.type_engin.designation}} </td>
                  <td>{{r.engin_rav.modele_engin.marque.nom_marque}}</td>
                  <td>{{r.engin_rav.modele_engin.nom_modele}}</td>
                  <td {% if r.niveau_carb < 15 %} style="background-color: rgb(245, 160, 145);" {% elif r.niveau_carb <
                    35 %} style="background-color: rgb(231, 241, 86);" {% else %}
                    style="background-color: rgb(100, 233, 100);" {% endif %}>
                    {{r.engin_rav.immatriculation}} </td>
                  <td>{{r.cout_rav}} </td>
                  <td>{{r.quantite_rav}} </td>
                  <td>{{r.carb_dispo}}</td>
                  <td {% if r.niveau_carb < 15 %} style="background-color: rgb(245, 160, 145);" {% elif r.niveau_carb <
                    35 %} style="background-color: rgb(231, 241, 86);" {% else %}
                    style="background-color: rgb(100, 233, 100);" {% endif %}>
                    {{r.niveau_carb}} %</td>
                  <td>

                    {% if r.niveau_carb < 15 %} Niveau de carburant bas, songez à ravitailler {% elif r.niveau_carb < 35 %} Préparez un ravitaillement {% else %} Peut rouler pendant un bon moment {% endif %} </td>

                  
                </tr>

                {% endfor %}
              </tbody>
              <tr>
                <th>Total dépenses en carburant : </th>
                <td>{{cout_r}} F CFA</td>
              </tr>
            </table>
            <button class="btn btn-primary" data-toggle="collapse" data-target="#carburantSection"
            aria-expanded="false" aria-controls="carburantSection">
            Replier le tableau
          </button>

          <button class="btn btn-primary" data-toggle="collapse" data-target="#maintenanceSection"
            aria-expanded="false" aria-controls="maintenanceSection">
            voir maintenance
          </button>
          <button class="btn btn-primary" data-toggle="collapse" data-target="#vidangeSection"
            aria-expanded="false" aria-controls="vidangeSection">
            voir vidange
          </button>
          <button type="button" class="btn btn-default" onclick="printTable('dataTable2','Point sur le carburant')">
            <i class="fas fa-download"></i>
            Imprimer ce tableau
          </button>

          <button type="button" class="btn btn-default">
            <i class="fas fa-download"></i>
            <a href="">
              Générer un PDF</a>
          </button>
</div>
<br><br>

          <div class="collapse" id="maintenanceSection">
            <button class="btn btn-primary" data-toggle="collapse" data-target="#carburantSection"
                      aria-expanded="false" aria-controls="carburantSection">
                      Voir ravitaillement
                    </button>
            <h4 class="h3 mb-0 text-gray-800">Point sur les maintenances</h4>
            <table class="table table-bordered" id="dataTable3" width="100%" cellspacing="0">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Engin</th>
                  <th>Marque</th>
                  <th>Modèle</th>
                  <th>Immat.</th>
                  <th>Montant</th>
                  <th>Fournisseur</th>
                  <th>Type de maintenance</th>
                  <th>Motif</th>
                  
                </tr>
              </thead>
              <tbody>
                {% for m in maintenances %}
                <tr data-bs-toggle="collapse" data-bs-target="#details_{{ forloop.counter }}" aria-expanded="false"
                  aria-controls="details_{{ forloop.counter }}">
                  <td>{{ m.date_maint }}</td>
                  <td>{{ m.engin_maint.type_engin.designation}} </td>
                  <td>{{m.engin_maint.modele_engin.marque.nom_marque}}</td>
                  <td>{{m.engin_maint.modele_engin.nom_modele}}</td>
                  <td>{{m.engin_maint.immatriculation}} </td>
                  <td>{{m.cout_maint}} </td>
                  <td>{{m.fournisseur_maint.nom_fournisseur}} </td>
                  <td>{{m.type_maint.libelle_maint}} </td>
                  <td>{{m.motif_maint}} </td>

                </tr>

                {% endfor %}
              </tbody>
              <tr>
                <th>Total dépenses en maintenance : </th>
                <td>{{cout_m}} F CFA</td>
              </tr>
            </table>
            <button class="btn btn-primary" data-toggle="collapse" data-target="#maintenanceSection"
            aria-expanded="false" aria-controls="maintenanceSection">
            Replier le tableau
          </button>

          <button class="btn btn-primary" data-toggle="collapse" data-target="#carburantSection"
            aria-expanded="false" aria-controls="carburantSection">
            voir ravitaillement
          </button>
          <button class="btn btn-primary" data-toggle="collapse" data-target="#vidangeSection"
            aria-expanded="false" aria-controls="vidangeSection">
            voir vidange
          </button>
          <button type="button" class="btn btn-default" onclick="printTable('dataTable3','Point sur les maintenances')">
            <i class="fas fa-download"></i>
            Imprimer ce tableau
          </button>
</div>
<br><br>
<div class="collapse" id="vidangeSection">
  <button class="btn btn-primary" data-toggle="collapse" data-target="#carburantSection"
            aria-expanded="false" aria-controls="carburantSection">
            voir ravitaillement
          </button>
          <button class="btn btn-primary" data-toggle="collapse" data-target="#maintenanceSection"
            aria-expanded="false" aria-controls="maintenanceSection">
            voir maintenance
          </button>
            <h4 class="h3 mb-0 text-gray-800">Point sur les vidanges</h4>
            <table class="table table-bordered" id="dataTable4" width="100%" cellspacing="0">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Engin</th>
                  <th>Marque</th>
                  <th>Modèle</th>
                  <th>Immat.</th>
                  <th>Montant</th>
                  <th>Fournisseur</th>
                  <th>Kilométrage à la vidange</th>
                  
                </tr>
              </thead>
              <tbody>
                {% for v in vidanges %}
                <tr data-bs-toggle="collapse" data-bs-target="#details_{{ forloop.counter }}" aria-expanded="false"
                  aria-controls="details_{{ forloop.counter }}">
                  <td>{{ v.date_maint }}</td>
                  <td>{{ v.engin_maint.type_engin.designation}} </td>
                  <td>{{v.engin_maint.modele_engin.marque.nom_marque}}</td>
                  <td>{{v.engin_maint.modele_engin.nom_modele}}</td>
                  <td>{{v.engin_vid.immatriculation}} </td>
                  <td>{{v.cout_maint}} </td>
                  <td>{{v.fournisseur_maint.nom_fournisseur}} </td>

                  <td>{{v.Km_maint}} </td>

                </tr>

                {% endfor %}
              </tbody>
              <tr>
                <th>Total dépenses en vidange : </th>
                <td>{{cout_v}} F CFA</td>
              </tr>
            </table>
            <button class="btn btn-primary" data-toggle="collapse" data-target="#vidangeSection"
                      aria-expanded="false" aria-controls="vidangeSection">
                      Replier le tableau
                    </button>
                    <button class="btn btn-primary" data-toggle="collapse" data-target="#carburantSection"
                      aria-expanded="false" aria-controls="carburantSection">
                      voir ravitaillement
                    </button>
                    <button class="btn btn-primary" data-toggle="collapse" data-target="#maintenanceSection"
                      aria-expanded="false" aria-controls="maintenanceSection">
                      voir maintenance
                    </button>
                    <button type="button" class="btn btn-default" onclick="printTable('dataTable4','Point sur les vidanges')">
                      <i class="fas fa-download"></i>
                      Imprimer ce tableau
                    </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

{% elif type_bilan == 'techniques' %}
<!-- Page Heading -->
<br>
<div class="row d-sm-flex justify-content-center mb-2">

  <h1 class="h3 mb-0 text-gray-800">Bilan des interventions sur l'engin : {{engin.immatriculation}}
    ({{engin.type_engin.designation}}) </h1>

</div>

<div class="row d-sm-flex justify-content-center mb-2">

  <div class="col-xl-3 col-md-6 mb-4" data-toggle="collapse" data-target="#carburantSection1" aria-expanded="false"
  aria-controls="carburantSection1">
    <div class="card border-left-primary shadow h-100 py-2">
      <div class="card-body">
        <div class="row no-gutters align-items-center">
          <div class="col mr-2">
            <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
              Quantité totale de carburant ravitaillé</div>
            <div class="h5 mb-0 font-weight-bold text-gray-800"> {{quantite_rav}} F CFA</div>
          </div>
          
        </div>
      </div>
    </div>
  </div>

  <div class="col-xl-3 col-md-6 mb-4" data-toggle="collapse" data-target="#maintenanceSection1" aria-expanded="false"
  aria-controls="maintenanceSection1">
    <div class="card border-left-success shadow h-100 py-2">
      <div class="card-body">
        <div class="row no-gutters align-items-center">
          <div class="col mr-2">
            <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
              Nombre total de maintenance de l'engin</div>
            <div class="h5 mb-0 font-weight-bold text-gray-800">{{nb_maintenance}} F CFA</div>
          </div>
          
        </div>
      </div>
    </div>
  </div>

  <!-- Earnings (Monthly) Card Example -->
  <div class="col-xl-3 col-md-6 mb-4" data-toggle="collapse" data-target="#vidangeSection1" aria-expanded="false"
  aria-controls="vidangeSection1">
    <div class="card border-left-info shadow h-100 py-2">
      <div class="card-body">
        <div class="row no-gutters align-items-center">
          <div class="col mr-2">
            <div class="text-xs font-weight-bold text-info text-uppercase mb-1">Nombre total de vidange
              de l'engin
            </div>
            <div class="row no-gutters align-items-center">
              <div class="col-auto">
                <div class="h5 mb-0 mr-3 font-weight-bold text-gray-800">{{nb_vidange}} F CFA
                </div>
              </div>

            </div>
          </div>
          
        </div>
      </div>
    </div>
  </div>


</div>
<div class="row d-sm-flex justify-content-center mb-2">
  <div class="container mt-3">
    <div class="row">
      <div class="col">
        <div class="collapse" id="carburantSection1">
          <h4 class="h3 mb-0 text-gray-800">Point sur les interventions en carburant</h4>
          <table class="table table-bordered" id="dataTable5" width="100%" cellspacing="0">
            <thead>
              <tr>
                <th>Engin</th>
                  <th>Marque</th>
                  <th>Modèle</th>
                  <th>Immat.</th>
                  <th>Montant</th>
                  <th>Quantité</th>
                  <th>Carb. Dispo</th>
                  <th>Ecart de conso.</th>
                  <th>Observation</th>
                  
              </tr>
            </thead>
            <tbody>
              {% for r in ravitaillements %}
              <tr data-bs-toggle="collapse" data-bs-target="#details_{{ forloop.counter }}" aria-expanded="false"
                aria-controls="details_{{ forloop.counter }}">
                <td>{{ r.date_rav }}</td>
                  <td>{{ r.engin_rav.type_engin.designation}} </td>
                  <td>{{r.engin_rav.modele_engin.marque.nom_marque}}</td>
                  <td>{{r.engin_rav.modele_engin.nom_modele}}</td>
                  <td {% if r.ecart_conso < 20 %} style="background-color: rgb(100, 233, 100);" {% elif r.ecart_conso <
                    35 %} style="background-color: rgb(231, 241, 86);" {% else %}
                    style="background-color: rgb(231, 104, 82);" {% endif %}>
                    {{r.engin_rav.immatriculation}} </td>
                  <td>{{r.cout_rav}} </td>
                  <td>{{r.quantite_rav}} </td>
                  <td>{{r.carb_dispo}}</td>
                  <td {% if r.ecart_conso < 20 %} style="background-color: rgb(100, 233, 100);" {% elif r.ecart_conso <
                    35 %} style="background-color: rgb(231, 241, 86);" {% else %}
                    style="background-color: rgb(231, 104, 82);" {% endif %}>
                    {{r.ecart_conso}} %</td>
                  <td>

                    {% if r.ecart_conso < 20 %} Consommation acceptable {% elif r.ecart_conso < 35 %} Engin à suivre de
                      près {% else %} Consomme trop, envoyer l'engin en maintenance {% endif %} </td>

                  
              </tr>

              {% endfor %}
            </tbody>
            <tr>
              <th>Quantité totale de carburant : </th>
              <td>{{quantite_rav}}</td>
            </tr>
          </table>
          <button class="btn btn-primary" data-toggle="collapse" data-target="#carburantSection1"
          aria-expanded="false" aria-controls="carburantSection1">
          Replier le tableau
        </button>
        <button class="btn btn-primary" data-toggle="collapse" data-target="#maintenanceSection1"
          aria-expanded="false" aria-controls="maintenanceSection1">
          voir maintenance
        </button>
        <button class="btn btn-primary" data-toggle="collapse" data-target="#vidangeSection1"
          aria-expanded="false" aria-controls="vidangeSection1">
          voir vidange
        </button>
        <button type="button" class="btn btn-default" onclick="printTable('dataTable5','Point sur les interventions en carburant')">
          <i class="fas fa-download"></i>
          Imprimer ce tableau
        </button>
</div>
<br><br>
<div class="collapse" id="maintenanceSection1">
<button class="btn btn-primary" data-toggle="collapse" data-target="#carburantSection1"
          aria-expanded="false" aria-controls="carburantSection1">
          Voir ravitaillement
        </button>
          <h4 class="h3 mb-0 text-gray-800">Point sur les interventions en maintenance</h4>
          <table class="table table-bordered" id="dataTable6" width="100%" cellspacing="0">
            <thead>
              <tr>
                <th>Date</th>
                <th>Engin</th>
                <th>Marque</th>
                <th>Modèle</th>
                <th>Immat.</th>
                <th>Montant</th>
                <th>Fournisseur</th>
                <th>Type de maintenance</th>
                <th>Motif</th>
                <th>Révision</th>
                
              </tr>
            </thead>
            <tbody>
              {% for m in maintenances %}
              <tr data-bs-toggle="collapse" data-bs-target="#details_{{ forloop.counter }}" aria-expanded="false"
                aria-controls="details_{{ forloop.counter }}">
                <td>{{ m.date_maint }}</td>
                <td>{{ m.engin_maint.type_engin.designation}} </td>
                <td>{{m.engin_maint.modele_engin.marque.nom_marque}}</td>
                <td>{{m.engin_maint.modele_engin.nom_modele}}</td>
                <td>{{m.engin_maint.immatriculation}} </td>
                <td>{{m.cout_maint}} </td>
                <td>{{m.fournisseur_maint.nom_fournisseur}} </td>
                <td>{{m.type_maint.libelle_maint}} </td>
                <td>{{m.motif_maint}} </td>
                <td>Dans {{m.reviz}} jours</td>
                
              </tr>

              {% endfor %}
            </tbody>
            <tr>
              <th>Nombre total de maintenance : </th>
              <td>{{nb_maintenance}}</td>
            </tr>
          </table>
          <button class="btn btn-primary" data-toggle="collapse" data-target="#maintenanceSection1"
          aria-expanded="false" aria-controls="maintenanceSection1">
          Replier le tableau
        </button>
        <button class="btn btn-primary" data-toggle="collapse" data-target="#carburantSection1"
          aria-expanded="false" aria-controls="carburantSection1">
          voir ravitaillement
        </button>
        <button class="btn btn-primary" data-toggle="collapse" data-target="#vidangeSection1"
          aria-expanded="false" aria-controls="vidangeSection1">
          voir vidange
        </button>
        <button type="button" class="btn btn-default" onclick="printTable('dataTable6','Point sur les interventions en maintenance')">
          <i class="fas fa-download"></i>
          Imprimer ce tableau
        </button>
        
</div>
<br><br>
<div class="collapse" id="vidangeSection1">
<button class="btn btn-primary" data-toggle="collapse" data-target="#carburantSection1"
          aria-expanded="false" aria-controls="carburantSection1">
          voir ravitaillement
        </button>
        <button class="btn btn-primary" data-toggle="collapse" data-target="#maintenanceSection1"
          aria-expanded="false" aria-controls="maintenanceSection1">
          voir maintenance
        </button>
          <h4 class="h3 mb-0 text-gray-800">Point sur les interventions en vidange</h4>
          <table class="table table-bordered" id="dataTable7" width="100%" cellspacing="0">
            <thead>
              <tr>
                <th>Date</th>
                <th>Engin</th>
                <th>Marque</th>
                <th>Modèle</th>
                <th>Immat.</th>
                <th>Montant</th>
                <th>Fournisseur</th>
                <th>Kilométrage à la vidange</th>
                <th>Prochaine vidange</th>
                
              </tr>
            </thead>
            <tbody>
              {% for v in vidanges %}
              <tr data-bs-toggle="collapse" data-bs-target="#details_{{ forloop.counter }}" aria-expanded="false"
                aria-controls="details_{{ forloop.counter }}">
                <td>{{ v.date_maint }}</td>
                <td>{{ v.engin_maint.type_engin.designation}} </td>
                <td>{{v.engin_maint.modele_engin.marque.nom_marque}}</td>
                <td>{{v.engin_maint.modele_engin.nom_modele}}</td>
                <td>{{v.engin_vid.immatriculation}} </td>
                <td>{{v.cout_maint}} </td>
                <td>{{v.fournisseur_maint.nom_fournisseur}} </td>

                <td>{{v.Km_maint}} </td>
                <td>

                  {% if v.engin_maint.type_engin.designation == 'TRICYCLE' %}
                  Dans {{v.vid}} jours
                  {% else %}
                  Après {{v.vid}} Km
                  {% endif %}

                </td>
              </tr>

              {% endfor %}
            </tbody>
            <tr>
              <th>Nombre total de vidange : </th>
              <td>{{nb_vidange}}</td>
            </tr>
          </table>
          <button class="btn btn-primary" data-toggle="collapse" data-target="#vidangeSection1"
                          aria-expanded="false" aria-controls="vidangeSection1">
                          Replier le tableau
                        </button>
                        <button class="btn btn-primary" data-toggle="collapse" data-target="#carburantSection1"
                          aria-expanded="false" aria-controls="carburantSection1">
                          voir ravitaillement
                        </button>
                        <button class="btn btn-primary" data-toggle="collapse" data-target="#maintenanceSection1"
                          aria-expanded="false" aria-controls="maintenanceSection1">
                          voir maintenance
                        </button>
                        <button type="button" class="btn btn-default" onclick="printTable('dataTable7','Point sur les interventions en vidange')">
                          <i class="fas fa-download"></i>
                          Imprimer ce tableau
                        </button>
        </div>
      </div>
    </div>
  </div>
  {% else %}
  <h4>TYPE NON TROUV</h4>

  {% endif %}
</div>
<script>
  function printTable(tableId, headerText) {
    var table = document.getElementById(tableId);
    var newWin = window.open('', 'Print-Window');
    newWin.document.open();
    newWin.document.write('<html><head><style>@media print { .header { text-align: center; font-size: 16px; font-weight: bold; margin: 10px; } }</style></head><body onload="window.print()">' +
      '<div class="header">' + headerText + '</div>' +
      table.outerHTML + '</body></html>');
    newWin.document.close();
    newWin.focus();
    newWin.print();
    newWin.close();
  }
  </script>
  
{% endblock contenu %}